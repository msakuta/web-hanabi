(function(e){function t(t){for(var r,i,o=t[0],l=t[1],c=t[2],d=0,b=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&b.push(a[i][0]),a[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(b.length)b.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,o=1;o<n.length;o++){var l=n[o];0!==a[l]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={app:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"05fe":function(e,t,n){},"37ba":function(e,t,n){"use strict";n("836a")},"51aa":function(e,t,n){"use strict";n("ddc3")},"836a":function(e,t,n){},adb1:function(e,t,n){"use strict";n("05fe")},cd49:function(e,t,n){"use strict";n.r(t),n.d(t,"offlineMode",(function(){return se})),n.d(t,"enableDebugMode",(function(){return oe})),n.d(t,"db",(function(){return le})),n.d(t,"userId",(function(){return de})),n.d(t,"loadUserName",(function(){return be}));var r=n("1da1"),a=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("96cf"),n("7a23")),s={class:"appContainer"},i=Object(a["g"])("h1",null,"Web-hanabi",-1),o=Object(a["g"])("hr",null,null,-1),l=Object(a["f"])(" Powered by "),c=Object(a["g"])("a",{href:"https://v3.vuejs.org/"},"Vue.js",-1),u=Object(a["g"])("br",null,null,-1),d=Object(a["f"])(" Source on "),b=Object(a["g"])("a",{href:"https://github.com/msakuta/web-hanabi"},"GitHub",-1),h=Object(a["f"])(". ");function f(e,t,n,r,f,p){var y=Object(a["n"])("web-hanabi");return Object(a["h"])(),Object(a["d"])("div",s,[i,Object(a["g"])(y),o,l,c,u,d,b,h])}n("d3b7"),n("25f0"),n("13d5");var p=Object(a["s"])("data-v-71c5f2f8");Object(a["j"])("data-v-71c5f2f8");var y={key:0},g=Object(a["f"])("Debug mode "),v=Object(a["f"])(" User Name: "),m=Object(a["f"])(" : "),O=Object(a["f"])(" Discarded cards: "),j={class:"history"};Object(a["i"])();var C=p((function(e,t,n,r,s,i){var o=Object(a["n"])("player-compo");return Object(a["h"])(),Object(a["d"])(a["a"],null,[r.enableDebugMode?(Object(a["h"])(),Object(a["d"])("div",y,[Object(a["g"])("label",null,[Object(a["r"])(Object(a["g"])("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=function(e){return r.debugMode=e})},null,512),[[a["p"],r.debugMode]]),g])])):Object(a["e"])("",!0),Object(a["g"])("div",null,"User Id: "+Object(a["o"])(r.userId),1),Object(a["g"])("div",null,[v,Object(a["r"])(Object(a["g"])("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=function(e){return r.gameState.userName=e})},null,512),[[a["q"],r.gameState.userName]]),Object(a["g"])("button",{onClick:t[3]||(t[3]=function(){return r.setUserName&&r.setUserName.apply(r,arguments)})},"Set")]),Object(a["g"])("div",null,[Object(a["f"])(" Session id: "+Object(a["o"])(r.gameState.sessionId)+" ",1),Object(a["g"])("button",{onClick:t[4]||(t[4]=function(){return r.newSession&&r.newSession.apply(r,arguments)})},"New session"),Object(a["g"])("button",{onClick:t[5]||(t[5]=function(){return r.joinSession&&r.joinSession.apply(r,arguments)})},"Join session")]),Object(a["g"])("div",null,[Object(a["r"])(Object(a["g"])("input",{type:"text",ref:"sessionUrlInput","onUpdate:modelValue":t[6]||(t[6]=function(e){return r.sessionUrl=e}),readonly:""},null,512),[[a["q"],r.sessionUrl]]),Object(a["g"])("button",{onClick:t[7]||(t[7]=function(){return r.copySessionUrl&&r.copySessionUrl.apply(r,arguments)})},"Copy URL to clipboard")]),Object(a["g"])("p",null,[Object(a["f"])(" Remaining cards ("+Object(a["o"])(r.gameState.fieldCards.length)+") ",1),r.debugMode?(Object(a["h"])(),Object(a["d"])(a["a"],{key:0},[m,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(r.gameState.fieldCards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card",e.getClass()]},Object(a["o"])(e.toString()+" "),3)})),128))],64)):Object(a["e"])("",!0)]),Object(a["g"])("div",null,[Object(a["f"])(" Played cards ("+Object(a["o"])(r.gameState.playedCards.reduce((function(e,t){return e+t.length}),0))+"/25): ",1),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(r.gameState.playedCards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card",e.length?e[e.length-1].getClass():""]},Object(a["o"])(e.length?e[e.length-1].toString():""),3)})),128))]),Object(a["g"])("div",null,[O,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(r.gameState.discardedCards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card",e.getClass()]},Object(a["o"])(e.toString()),3)})),128))]),Object(a["g"])("div",j,[Object(a["g"])("ul",null,[(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(r.historyReversed,(function(e){return Object(a["h"])(),Object(a["d"])("li",{key:e},Object(a["o"])(r.substituteHistory(e)),1)})),128))])]),Object(a["g"])("div",null," Tokens: "+Object(a["o"])(r.gameState.tokens),1),Object(a["g"])("div",null," Strikes: "+Object(a["o"])(r.gameState.strikes),1),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(r.gameState.players,(function(e,t){return Object(a["h"])(),Object(a["d"])(o,{key:t,idx:t,player:e,isSelfPlayer:r.gameState.thePlayer===t,debugMode:r.debugMode,activeTurn:!r.gameState.gameOver&&r.turn===t,selectedCard:r.selectedCard,selectedHintPlayer:r.selectedHintPlayer===t,onPlayerAutoClick:function(t){return r.togglePlayerAuto(e)},onPlayerCardClick:function(t){return r.playerCardClick(e,t)},onPlayCard:function(t){return r.playCard(e,t)},onDiscardCard:function(t){return r.discardCard(e,t)},onSelectHint:function(e){return r.selectHint(t,e)},onDoHint:function(t){return r.doHint(e,t)}},null,8,["idx","player","isSelfPlayer","debugMode","activeTurn","selectedCard","selectedHintPlayer","onPlayerAutoClick","onPlayerCardClick","onPlayCard","onDiscardCard","onSelectHint","onDoHint"])})),128))],64)})),k=(n("99af"),n("a434"),n("b0c0"),n("fb6a"),n("d81d"),n("cb29"),Object(a["s"])("data-v-483542c4"));Object(a["j"])("data-v-483542c4");var P={style:{position:"absolute",left:"0",right:"0",width:"8em",height:"5em"}},S=Object(a["f"])("Auto "),H={style:{position:"absolute",left:"8em",top:"0",width:"20em",height:"5em"}},w={style:{"font-size":"+2","font-weight":"bold"}},N={class:"cardLetter"},A=Object(a["g"])("br",null,null,-1),I={key:0,style:{position:"absolute",left:"28em",width:"5em",height:"3em"}},x={key:1,style:{position:"absolute",left:"3em",top:"5em",width:"30em",height:"2em"}};Object(a["i"])();var T=k((function(e,t,n,r,s,i){return Object(a["h"])(),Object(a["d"])("div",{class:["frame",n.activeTurn?"activeFrame":"inactiveFrame"]},[Object(a["g"])("span",P,[Object(a["g"])("div",{class:n.isSelfPlayer?"selfBorder":""},Object(a["o"])(n.activeTurn?"* ":"  ")+" "+Object(a["o"])(n.player.name)+": ",3),Object(a["g"])("label",null,[Object(a["g"])("input",{type:"checkbox",checked:n.player.auto,onClick:t[1]||(t[1]=function(){return r.playerAutoClick&&r.playerAutoClick.apply(r,arguments)})},null,8,["checked"]),S])]),Object(a["g"])("span",H,[(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(n.player.cards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card","noselect",!n.debugMode&&n.isSelfPlayer?"hidden":e.getClass(),n.activeTurn&&t===n.selectedCard?"selected":""],style:"left: ".concat(5*t,"em;"),onClick:function(e){return r.playerCardClick(t)}},[Object(a["g"])("div",w,[Object(a["g"])("span",N,Object(a["o"])(r.cardLetter(t))+": ",1),Object(a["f"])(" "+Object(a["o"])(!n.debugMode&&n.isSelfPlayer?"??":e.toString()),1)]),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:r.cardNumberHintClass(e,t),style:"left: ".concat(5*t+1,"px;")},Object(a["o"])(t+1),7)})),128)),A,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:r.cardColorHintClass(e,t),style:"left: ".concat(5*t+1,"px;")},Object(a["o"])(r.getColor(t)),7)})),128))],14,["onClick"])})),128))]),n.debugMode||n.isSelfPlayer?(Object(a["h"])(),Object(a["d"])("div",I,[Object(a["g"])("button",{onClick:t[2]||(t[2]=function(e){return r.playCard(n.selectedCard)})},"Play"),Object(a["g"])("button",{onClick:t[3]||(t[3]=function(e){return r.discardCard(n.selectedCard)})},"Discard")])):Object(a["e"])("",!0),n.debugMode||!n.isSelfPlayer?(Object(a["h"])(),Object(a["d"])("div",x,[Object(a["g"])("span",{class:["noselect","hintButton",n.selectedHintPlayer?"hintButtonActive":""],onClick:t[4]||(t[4]=function(){return r.doHint&&r.doHint.apply(r,arguments)})}," Hint ",2),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(e){return Object(a["h"])(),Object(a["d"])("span",{key:e,class:["noselect","hintSelectButton",n.selectedHintPlayer&&e===r.selectedHint?"hintSelected":""],onClick:function(t){return r.selectHint(e)}},Object(a["o"])(e+1),11,["onClick"])})),128)),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(e){return Object(a["h"])(),Object(a["d"])("span",{key:e,class:["noselect",r.getClass(e),"hintSelectButton",n.selectedHintPlayer&&e+5===r.selectedHint?"hintSelected":""],onClick:function(t){return r.selectHint(e+5)}},Object(a["o"])(r.getColor(e)),11,["onClick"])})),128))])):Object(a["e"])("",!0)],2)})),_=(n("a9e3"),n("d4ec")),D=n("bee2"),U=(n("1276"),n("ac1f"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(_["a"])(this,e),this.number=1,this.color=1,this.possibleNumbers=31,this.possibleColors=31,this.number=t,this.color=n}return Object(D["a"])(e,[{key:"toString",value:function(){return"".concat(this.getColor()).concat(this.number+1)}},{key:"serialize",value:function(){return this.toString()+":".concat(this.possibleNumbers,":").concat(this.possibleColors)}},{key:"deserialize",value:function(e){this.color=z(e[0]),this.number=e[1].charCodeAt(0)-"1".charCodeAt(0);var t=e.substr(3).split(":");0<t.length&&(this.possibleNumbers=parseInt(t[0])),1<t.length&&(this.possibleColors=parseInt(t[1]))}},{key:"getColor",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(t=null!==(e=t)&&void 0!==e?e:this.color,t){case 0:return"r";case 1:return"g";case 2:return"b";case 3:return"y";case 4:return"w";case 5:return"x";default:return"?"}}},{key:"getClass",value:function(){return V(this.color)}},{key:"hintNumber",value:function(e){return this.number===e?(this.possibleNumbers&=1<<e,!0):(this.possibleNumbers&=31&~(1<<e),!1)}},{key:"hintColor",value:function(e){return this.color===e?(this.possibleColors&=1<<e,!0):(this.possibleColors&=31&~(1<<e),!1)}}]),e}());function M(){for(var e=[],t=0;t<5;t++)for(var n=0;n<(0==t?3:t<4?2:1);n++)for(var r=0;r<5;r++)e.push(new U(t,r));return e}function R(e,t){return void 0===t&&(t=e.length-1),e.splice(t,1)[0]}function B(e){return String.fromCharCode("A".charCodeAt(0)+e)}function E(e){return 0===e.length?"none are":1===e.length?B(e[0])+" is":e.reduce((function(t,n,r){return(r===e.length-1?t+" and ":0<r?t+", ":"")+B(n)}),"")+" are"}function z(e){switch(e){case"r":return 0;case"g":return 1;case"b":return 2;case"y":return 3;case"w":return 4;case"x":return 5;default:return-1}}function V(e){switch(e){case 0:return"red";case 1:return"green";case 2:return"blue";case 3:return"yellow";case 4:return"white";case 5:return"rainbow";default:return""}}var G={name:"Player ",props:{idx:Number,isSelfPlayer:Boolean,debugMode:Boolean,player:Object,selectedCard:Number,activeTurn:Boolean,selectedHintPlayer:Boolean},setup:function(e,t){var n=Object(a["l"])(-1);return{playerAutoClick:function(){return t.emit("playerAutoClick")},playerCardClick:function(e){return t.emit("playerCardClick",e)},playCard:function(e){return t.emit("playCard",e)},discardCard:function(e){return t.emit("discardCard",e)},getColor:function(e){return U.prototype.getColor(e)},selectHint:function(r){var a=n.value===r&&e.selectedHintPlayer;n.value=a?-1:r,t.emit("selectHint",a)},doHint:function(){0<=n.value&&t.emit("doHint",n.value)},cardLetter:B,getClass:V,selectedHint:n,cardNumberHintClass:function(t,r){var a=["small",t.possibleNumbers&1<<r?"possible":"notPossible"];return e.selectedHintPlayer&&n.value<5&&(t.number===n.value?r===n.value?a.push("selectedHint"):t.possibleNumbers&1<<r&&a.push("selectedAntiHint"):r===n.value&&t.possibleNumbers&1<<r&&a.push("selectedAntiHint")),a},cardColorHintClass:function(t,r){var a=["small",t.possibleColors&1<<r?"possible":"notPossible"];return e.selectedHintPlayer&&5<=n.value&&(t.color+5===n.value?r+5===n.value?a.push("selectedHint"):t.possibleColors&1<<r&&a.push("selectedAntiHint"):r+5===n.value&&t.possibleColors&1<<r&&a.push("selectedAntiHint")),a}}}};n("51aa");G.render=T,G.__scopeId="data-v-483542c4";var W=G,L=n("2909"),J=(n("c740"),n("53ca")),Y=n("b85c");n("7db0"),n("4de4");function Z(e,t){return e.reduce((function(e,n){return e+(t(n)?1:0)}),0)}var K=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;Object(_["a"])(this,e),this.name="",this.auto=!1,this.name=t,this.auto=r,this.cards=a?Object(L["a"])(Array(4)).map((function(){return a(n,Math.floor(Math.random()*n.length))})):[]}return Object(D["a"])(e,[{key:"serialize",value:function(){var e={name:this.name,auto:this.auto,cards:this.cards.map((function(e){return e.serialize()}))};return this.playerId&&(e.playerId=this.playerId),this.lastHintedNumber&&(e.lastHintedNumber=this.lastHintedNumber),this.lastHintedColor&&(e.lastHintedColor=this.lastHintedColor),e}},{key:"deserialize",value:function(e){this.name=e.name,this.playerId=e.playerId,this.auto=e.auto,this.cards=e.cards.map((function(e){var t=new U;return t.deserialize(e),t})),this.lastHintedNumber=e.lastHintedNumber,this.lastHintedColor=e.lastHintedColor}},{key:"think",value:function(e,t,n,r,a){var s=this,i=function(){var t=s.lastHintedNumber;if(t){var n=t.number;if(e.globalTurn-e.players.length<=t.turn&&e.playedCards.find((function(e){return(0===n||e[n-1])&&!e[n]})))return s.cards.findIndex((function(e){return e.possibleNumbers===1<<n}))}var r=s.lastHintedColor;if(r){var a=Z(s.cards,(function(e){return e.color===r.color}));if(1===a&&e.globalTurn-e.players.length<=r.turn)return s.cards.findIndex((function(e){return e.color===r.color}))}return-1}();if(0<=i)n(this,i,!0);else{if(0!==e.tokens){var o,l=Object(L["a"])(Array(5)).map((function(e,t){return t})).filter((function(t){return!!e.playedCards.find((function(e){return(0===t||e[t-1])&&!e[t]}))})),c=Object(Y["a"])(e.players);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(u!==this){var d,b=Object(Y["a"])(l);try{var h=function(){var t,n=d.value,r=0,s=0,i=Object(Y["a"])(u.cards);try{var o=function(){var a=t.value;a.number===n&&s++,a.number===n&&a.possibleNumbers!==1<<n&&e.playedCards.find((function(e,t){return(0===n||e[n-1])&&!e[n]&&t===a.color}))&&r++};for(i.s();!(t=i.n()).done;)o()}catch(l){i.e(l)}finally{i.f()}if(0<s&&r===s)return a(u,n,!0),{v:void 0}};for(b.s();!(d=b.n()).done;){var f=h();if("object"===Object(J["a"])(f))return f.v}}catch(p){b.e(p)}finally{b.f()}}}}catch(p){c.e(p)}finally{c.f()}}r(this,this.cards.length-1,!0)}}},{key:"hintNumber",value:function(e,t){for(var n=[],r=0;r<this.cards.length;r++)this.cards[r].hintNumber(e)&&n.push(r);return this.lastHintedNumber={number:e,turn:t},n}},{key:"hintColor",value:function(e,t){for(var n=[],r=0;r<this.cards.length;r++)this.cards[r].hintColor(e)&&n.push(r);return this.lastHintedColor={color:e,turn:t},n}}]),e}(),q=(n("2b3d"),n("3ca3"),n("ddb0"),n("841c"),20);function F(){if(se||!le)return"";var e=le.collection("/sessions").doc();return e.set({}),localStorage.setItem("WebHanabiSessionId",e.id),e.id}function Q(){if(se||!le)return"";var e=new URLSearchParams(document.location.search.substring(1)),t=e.get("sessionId");if(t&&t.length===q)return t;var n=localStorage.getItem("WebHanabiSessionId");return t=n&&"string"===typeof n&&n.length===q?n:F(),t}function X(e){localStorage.setItem("WebHanabiSessionId",e)}var $=function(){function e(){Object(_["a"])(this,e),this.history=[],this.fieldCards=[],this.discardedCards=[],this.playedCards=Object(L["a"])(Array(5)).map((function(){return[]})),this.players=[],this.thePlayer=0,this.globalTurn=0,this.tokens=8,this.strikes=0,this.startDate=0,this.lastRoundBegun=-1,this.userName="",this.sessionId=Q(),this.resetGame()}return Object(D["a"])(e,[{key:"gameOver",get:function(){return 3<=this.strikes||this.playedCards.reduce((function(e,t){return e&&0<t.length&&4===t[t.length-1].number}),!0)||0<=this.lastRoundBegun&&this.lastRoundBegun+this.players.length<=this.globalTurn}},{key:"resetGame",value:function(){var e=this;this.thePlayer=0,this.history=[],this.fieldCards=M(),this.discardedCards=[],this.playedCards=Object(L["a"])(Array(5)).map((function(){return[]})),this.players=Object(L["a"])(Array(4)).map((function(t,n){return new K(n===e.thePlayer?e.userName:"Player ".concat(n),e.fieldCards,0!==n,R)})),this.players[this.thePlayer].playerId=de,this.globalTurn=0,this.tokens=8,this.strikes=0,this.startDate=Date.now(),this.endDate=void 0,this.lastRoundBegun=-1}},{key:"init",value:function(){var e=this;be().then((function(t){e.userName=t,e.players[e.thePlayer].name=t,e.players[e.thePlayer].playerId=de})),this.loadSession(this.sessionId).then((function(t){return e.deserializeSession(t)})),this.subscribe()}},{key:"setUserName",value:function(){!se&&le?(le.collection("/users").doc(de).set({name:this.userName}),this.sessionId&&0<=this.thePlayer&&(this.players[this.thePlayer].name=this.userName,this.updateSession())):this.players[this.thePlayer].name=this.userName}},{key:"subscribe",value:function(){var e=this;!se&&le&&(this.unsubscriber&&this.unsubscriber(),this.unsubscriber=le.collection("/sessions").doc(this.sessionId).onSnapshot({next:function(t){t.exists&&(e.deserializeSession(t),e.tryNextMove&&e.tryNextMove(!0))}}))}},{key:"newSession",value:function(){confirm("This session will be discarded. Are you sure?")&&(this.sessionId=F(),this.subscribe(),this.resetGame(),this.updateSession())}},{key:"updateSession",value:function(){if(!se&&le){console.log("updateSession ".concat(this.globalTurn));var e={history:this.history,fieldCards:this.fieldCards.map((function(e){return e.serialize()})),discardedCards:this.discardedCards.map((function(e){return e.serialize()})),playedCards:this.playedCards.map((function(e){return e.length})),players:this.players.map((function(e){return e.serialize()})),globalTurn:this.globalTurn,tokens:this.tokens,strikes:this.strikes,startDate:this.startDate};0<=this.lastRoundBegun&&(e.lastRoundBegun=this.lastRoundBegun),this.endDate&&(e.endDate=this.endDate),le.collection("/sessions").doc(this.sessionId).update(e)}}},{key:"deserializeSession",value:function(e){var t=this;if(!e)return null;var n=e.get("history");if(void 0===n)return null;var r=e.get("fieldCards");if(!r)return null;var a=e.get("discardedCards");if(!a)return null;var s=e.get("playedCards");if(!s)return null;var i=e.get("players");if(!i)return null;var o=e.get("globalTurn");if(void 0===o)return null;var l=e.get("tokens");if(void 0===l)return null;var c=e.get("strikes");if(void 0===c)return null;var u=e.get("startDate");if(void 0===u)return null;var d=e.get("endDate"),b=e.get("lastRoundBegun");console.log("deserializeSession ".concat(o)),this.history=n,this.fieldCards=r.map((function(e){var t=new U;return t.deserialize(e),t})),this.discardedCards=a.map((function(e){var t=new U;return t.deserialize(e),t})),this.playedCards=s.map((function(e,t){return Object(L["a"])(Array(e)).map((function(e,n){return new U(n,t)}))})),this.thePlayer=-1;var h=!1;if(this.players=i.map((function(e,n){var r=new K("",[],void 0);return r.deserialize(e),r.playerId===de&&(t.thePlayer=n,h=!0),r})),this.globalTurn=o,this.tokens=l,this.strikes=c,this.lastRoundBegun=void 0===b?-1:b,this.startDate=u,this.endDate=d,!h){var f=this.players.findIndex((function(e){return!e.playerId}));0<=f&&(this.players[f].name=this.userName,this.players[f].playerId=de,this.players[f].auto=!1,this.updateSession())}}},{key:"loadSession",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!se&&le){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,le.collection("/sessions").doc(t).get();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"joinSession",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=prompt("Enter session id"),t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.loadSession(t);case 5:n=e.sent,this.deserializeSession(n),this.sessionId=t,this.subscribe(),X(t);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"playerName",value:function(e){var t=this.players.indexOf(e);return t===this.thePlayer?"You":"Player ".concat(t)}}]),e}(),ee={name:"WebHanabi",components:{PlayerCompo:W},setup:function(){var e=Object(a["k"])(new $);e.init();var t=Object(a["l"])(-1),n=Object(a["b"])((function(){return e.globalTurn%e.players.length})),r=Object(a["l"])(!1),s=Object(a["b"])((function(){return"".concat(document.location.origin).concat(document.location.pathname,"?sessionId=").concat(e.sessionId)})),i=Object(a["l"])(null),o=Object(a["l"])(-1),l=!1;function c(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||e.updateSession();var r=e.players[n.value];!r.auto||e.gameOver||l||0!==e.thePlayer||(l=!0,setTimeout((function(){var t=e.players[n.value];t.think(e,e.globalTurn,b,h,f),l=!1,c()}),1e3))}function u(r,a){n.value===e.players.indexOf(r)?t.value=a:console.log("Hey, it's not your turn! turn: ".concat(n.value,", player: ").concat(e.players.indexOf(r)))}function d(){e.gameOver&&(e.history.push("[".concat(e.globalTurn+1,"] The game is over! Your score was ").concat(e.playedCards.reduce((function(e,t){return e+t.length}),0))),e.endDate=Date.now())}function b(r,a){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(n.value===e.players.indexOf(r)&&(s||!r.auto&&n.value===e.thePlayer))if(a<0)alert("Please select a card.");else{var i=r.cards[a];r.cards.splice(a,1);var o=!1;0===e.playedCards[i.color].length&&0!==i.number||0<e.playedCards[i.color].length&&i.number!==e.playedCards[i.color][e.playedCards[i.color].length-1].number+1?(e.strikes++,o=!0):(e.playedCards[i.color].push(i),4===i.number&&(e.tokens=Math.min(8,e.tokens+1))),o&&e.discardedCards.push(i);var l=R(e.fieldCards,Math.floor(Math.random()*e.fieldCards.length));l&&r.cards.push(l),0===e.fieldCards.length&&e.lastRoundBegun<0&&(e.lastRoundBegun=e.globalTurn),e.history.push("[".concat(e.globalTurn+1,"] {P").concat(e.players.indexOf(r),"} played ").concat(B(a)," which is ").concat(i.toString()," and it was ").concat(o?"a strike":"ok")),e.globalTurn++,t.value=-1,d(),c()}else alert("Hey, it's not your turn!")}function h(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(n.value!==e.players.indexOf(t)||!a&&t.auto)alert("Hey, it's not your turn!");else if(r<0)alert("Please select a card.");else{var s=t.cards[r];t.cards.splice(r,1),e.discardedCards.push(s);var i=R(e.fieldCards,Math.floor(Math.random()*e.fieldCards.length));i&&t.cards.push(i),0===e.fieldCards.length&&e.lastRoundBegun<0&&(e.lastRoundBegun=e.globalTurn),e.history.push("[".concat(e.globalTurn+1,"] {P").concat(e.players.indexOf(t),"} discarded ").concat(B(r)," which is ").concat(s.toString())),e.globalTurn++,e.tokens=Math.min(8,e.tokens+1),d(),c()}}function f(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(a||!e.players[n.value].auto&&n.value===e.thePlayer)if(!a&&e.players.indexOf(t)===e.thePlayer||e.players.indexOf(t)===n.value)alert("You can't hint yourself!");else if(e.tokens<=0)alert("You used up all tokens!");else{var s=t.hintNumber(r,e.globalTurn);e.history.push("[".concat(e.globalTurn+1,"] {P").concat(n.value,"} hinted {P").concat(e.players.indexOf(t),"} about ").concat(E(s)," number ").concat(r+1)),e.globalTurn++,e.tokens--,d(),c()}else alert("Hey, it's not your turn!")}function p(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(a||!e.players[n.value].auto&&n.value===e.thePlayer)if(!a&&e.players.indexOf(t)===e.thePlayer||e.players.indexOf(t)===n.value)alert("You can't hint yourself!");else if(e.tokens<=0)alert("You used up all tokens!");else{var s=t.hintColor(r,e.globalTurn);e.history.push("[".concat(e.globalTurn+1,"] {P").concat(n.value,"} hinted {P").concat(e.players.indexOf(t),"} about ").concat(E(s)," color ").concat(U.prototype.getColor(r))),e.globalTurn++,e.tokens--,d(),c()}else alert("Hey, it's not your turn!")}function y(t){return e.players.reduce((function(t,n,r){return t.replaceAll("{P".concat(r,"}"),r===e.thePlayer?"You":n.name)}),t)}function g(){var e=i.value;e&&(e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),alert("Copied the text: "+e.value))}return e.tryNextMove=c,{gameState:e,selectedCard:t,turn:n,playerCardClick:u,playCard:b,discardCard:h,doHint:function(t,n){e.players[o.value]===t&&(0<=n&&n<5?f(t,n):5<=n&&n<10&&p(t,n-5),o.value=-1)},hintColor:p,enableDebugMode:oe,debugMode:r,userId:de,selectedHintPlayer:o,setUserName:function(){return e.setUserName()},togglePlayerAuto:function(e){e.auto=!e.auto,c()},newSession:function(){return e.newSession()},joinSession:function(){return e.joinSession()},historyReversed:Object(a["b"])((function(){var t=e.history.slice();return t.reverse(),t})),substituteHistory:y,sessionUrl:s,sessionUrlInput:i,copySessionUrl:g,selectHint:function(e,t){o.value=t?-1:e}}}};n("37ba");ee.render=C,ee.__scopeId="data-v-71c5f2f8";var te=ee,ne={name:"App",components:{WebHanabi:te}};n("adb1");ne.render=f;var re=ne,ae=n("2591"),se=!1,ie={apiKey:"AIzaSyBAvtnHAo2_RAJpRWZNDDNOJOUN7gZppVo",authDomain:"web-hanabi.firebaseapp.com",projectId:"web-hanabi",storageBucket:"web-hanabi.appspot.com",messagingSenderId:"486326971095",appId:"1:486326971095:web:cba7224b5b6ce39cb39e92",measurementId:"G-93MV15EL3B"};ae["a"].initializeApp(ie),ae["a"].analytics();var oe="1"===Object({VUE_APP_API_KEY:"AIzaSyBAvtnHAo2_RAJpRWZNDDNOJOUN7gZppVo",VUE_APP_MESSAGING_SENDER_ID:"486326971095",VUE_APP_MEASUREMENT_ID:"G-93MV15EL3B",VUE_APP_STORAGE_BUCKET:"web-hanabi.appspot.com",VUE_APP_AUTH_DOMAIN:"web-hanabi.firebaseapp.com",VUE_APP_PROJECT_ID:"web-hanabi",VUE_APP_APP_ID:"1:486326971095:web:cba7224b5b6ce39cb39e92",NODE_ENV:"production",BASE_URL:""}).VUE_APP_ENABLE_DEBUG,le=se?null:ae["a"].firestore();function ce(){if(se||!le)return"";var e=le.collection("/users").doc();e.set({name:"new user"});var t=e.id;return localStorage.setItem("WebHanabiUserId",t),t}function ue(){if(!se&&le){var e=localStorage.getItem("WebHanabiUserId"),t="";return t=e&&"string"===typeof e&&0!==e.length?e:ce(),t}}var de=ue();function be(){return he.apply(this,arguments)}function he(){return he=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!se&&le){e.next=2;break}return e.abrupt("return","new user");case 2:return e.next=4,le.collection("/users").doc(de).get();case 4:if(t=e.sent,!t.exists){e.next=7;break}return e.abrupt("return",t.get("name"));case 7:return e.abrupt("return","new user");case 8:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}Object(a["c"])(re).mount("#app")},ddc3:function(e,t,n){}});
//# sourceMappingURL=app.1a6eae5b.js.map