(function(e){function t(t){for(var n,i,o=t[0],l=t[1],u=t[2],d=0,b=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&b.push(a[i][0]),a[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);c&&c(t);while(b.length)b.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,o=1;o<r.length;o++){var l=r[o];0!==a[l]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},s=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var c=l;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},"05fe":function(e,t,r){},"40d1":function(e,t,r){"use strict";r("fef3")},"69c6":function(e,t,r){"use strict";r("8330")},8330:function(e,t,r){},adb1:function(e,t,r){"use strict";r("05fe")},cd49:function(e,t,r){"use strict";r.r(t),r.d(t,"offlineMode",(function(){return ie})),r.d(t,"db",(function(){return le})),r.d(t,"userId",(function(){return de})),r.d(t,"loadUserName",(function(){return be}));var n=r("1da1"),a=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("96cf"),r("7a23")),s={class:"appContainer"},i=Object(a["g"])("h1",null,"Web-hanabi",-1),o=Object(a["g"])("hr",null,null,-1),l=Object(a["f"])(" Powered by "),u=Object(a["g"])("a",{href:"https://v3.vuejs.org/"},"Vue.js",-1),c=Object(a["g"])("br",null,null,-1),d=Object(a["f"])(" Source on "),b=Object(a["g"])("a",{href:"https://github.com/msakuta/web-hanabi"},"GitHub",-1),h=Object(a["f"])(". ");function f(e,t,r,n,f,p){var y=Object(a["n"])("web-hanabi");return Object(a["h"])(),Object(a["d"])("div",s,[i,Object(a["g"])(y),o,l,u,c,d,b,h])}r("d3b7"),r("25f0"),r("13d5");var p=Object(a["s"])("data-v-2012f31c");Object(a["j"])("data-v-2012f31c");var y=Object(a["f"])("Debug mode "),g=Object(a["f"])(" User Name: "),v=Object(a["f"])(" : "),m=Object(a["f"])(" Discarded cards: "),O={class:"history"};Object(a["i"])();var j=p((function(e,t,r,n,s,i){var o=Object(a["n"])("player-compo");return Object(a["h"])(),Object(a["d"])(a["a"],null,[Object(a["g"])("div",null,[Object(a["g"])("label",null,[Object(a["r"])(Object(a["g"])("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=function(e){return n.debugMode=e})},null,512),[[a["p"],n.debugMode]]),y])]),Object(a["g"])("div",null,"User Id: "+Object(a["o"])(n.userId),1),Object(a["g"])("div",null,[g,Object(a["r"])(Object(a["g"])("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=function(e){return n.gameState.userName=e})},null,512),[[a["q"],n.gameState.userName]]),Object(a["g"])("button",{onClick:t[3]||(t[3]=function(){return n.setUserName&&n.setUserName.apply(n,arguments)})},"Set")]),Object(a["g"])("div",null,[Object(a["f"])(" Session id: "+Object(a["o"])(n.gameState.sessionId)+" ",1),Object(a["g"])("button",{onClick:t[4]||(t[4]=function(){return n.newSession&&n.newSession.apply(n,arguments)})},"New session"),Object(a["g"])("button",{onClick:t[5]||(t[5]=function(){return n.joinSession&&n.joinSession.apply(n,arguments)})},"Join session")]),Object(a["g"])("div",null,[Object(a["r"])(Object(a["g"])("input",{type:"text",ref:"sessionUrlInput","onUpdate:modelValue":t[6]||(t[6]=function(e){return n.sessionUrl=e}),readonly:""},null,512),[[a["q"],n.sessionUrl]]),Object(a["g"])("button",{onClick:t[7]||(t[7]=function(){return n.copySessionUrl&&n.copySessionUrl.apply(n,arguments)})},"Copy URL to clipboard")]),Object(a["g"])("p",null,[Object(a["f"])(" Remaining cards ("+Object(a["o"])(n.gameState.fieldCards.length)+") ",1),n.debugMode?(Object(a["h"])(),Object(a["d"])(a["a"],{key:0},[v,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(n.gameState.fieldCards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card",e.getClass()]},Object(a["o"])(e.toString()+" "),3)})),128))],64)):Object(a["e"])("",!0)]),Object(a["g"])("div",null,[Object(a["f"])(" Played cards ("+Object(a["o"])(n.gameState.playedCards.reduce((function(e,t){return e+t.length}),0))+"/25): ",1),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(n.gameState.playedCards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card",e.length?e[e.length-1].getClass():""]},Object(a["o"])(e.length?e[e.length-1].toString():""),3)})),128))]),Object(a["g"])("div",null,[m,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(n.gameState.discardedCards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card",e.getClass()]},Object(a["o"])(e.toString()),3)})),128))]),Object(a["g"])("div",O,[Object(a["g"])("ul",null,[(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(n.historyReversed,(function(e){return Object(a["h"])(),Object(a["d"])("li",{key:e},Object(a["o"])(n.substituteHistory(e)),1)})),128))])]),Object(a["g"])("div",null," Tokens: "+Object(a["o"])(n.gameState.tokens),1),Object(a["g"])("div",null," Strikes: "+Object(a["o"])(n.gameState.strikes),1),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(n.gameState.players,(function(e,t){return Object(a["h"])(),Object(a["d"])(o,{key:t,idx:t,player:e,isSelfPlayer:n.gameState.thePlayer===t,debugMode:n.debugMode,activeTurn:!n.gameState.gameOver&&n.turn===t,selectedCard:n.selectedCard,onPlayerAutoClick:function(t){return n.togglePlayerAuto(e)},onPlayerCardClick:function(t){return n.playerCardClick(e,t)},onPlayCard:function(t){return n.playCard(e,t)},onDiscardCard:function(t){return n.discardCard(e,t)},onHintNumber:function(t){return n.hintNumber(e,t)},onHintColor:function(t){return n.hintColor(e,t)}},null,8,["idx","player","isSelfPlayer","debugMode","activeTurn","selectedCard","onPlayerAutoClick","onPlayerCardClick","onPlayCard","onDiscardCard","onHintNumber","onHintColor"])})),128))],64)})),C=(r("99af"),r("a434"),r("b0c0"),r("fb6a"),r("d81d"),r("cb29"),Object(a["s"])("data-v-5459dda5"));Object(a["j"])("data-v-5459dda5");var k={style:{position:"absolute",left:"0",right:"0",width:"8em",height:"5em"}},S=Object(a["f"])("Auto "),w={style:{position:"absolute",left:"8em",top:"0",width:"20em",height:"5em"}},P={style:{"font-size":"+2","font-weight":"bold"}},N={class:"cardLetter"},x=Object(a["g"])("br",null,null,-1),I={key:0,style:{position:"absolute",left:"28em",width:"5em",height:"3em"}},T={key:1,style:{position:"absolute",left:"3em",top:"5em",width:"25em",height:"2em"}},H=Object(a["f"])(" Hint: "),A=Object(a["f"])("   "),M=Object(a["f"])("   ");Object(a["i"])();var R=C((function(e,t,r,n,s,i){return Object(a["h"])(),Object(a["d"])("div",{class:["frame",r.activeTurn?"activeFrame":"inactiveFrame"]},[Object(a["g"])("span",k,[Object(a["g"])("div",{class:r.isSelfPlayer?"selfBorder":""},Object(a["o"])(r.activeTurn?"* ":"  ")+" "+Object(a["o"])(r.player.name)+": ",3),Object(a["g"])("label",null,[Object(a["g"])("input",{type:"checkbox",checked:r.player.auto,onClick:t[1]||(t[1]=function(){return n.playerAutoClick&&n.playerAutoClick.apply(n,arguments)})},null,8,["checked"]),S])]),Object(a["g"])("span",w,[(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(r.player.cards,(function(e,t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["card","noselect",!r.debugMode&&r.isSelfPlayer?"hidden":e.getClass(),r.activeTurn&&t===r.selectedCard?"selected":""],style:"left: ".concat(5*t,"em;"),onClick:function(e){return n.playerCardClick(t)}},[Object(a["g"])("div",P,[Object(a["g"])("span",N,Object(a["o"])(n.cardLetter(t))+": ",1),Object(a["f"])(" "+Object(a["o"])(!r.debugMode&&r.isSelfPlayer?"??":e.toString()),1)]),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["small",e.possibleNumbers&1<<t?"possible":"notPossible"],style:"left: ".concat(5*t+1,"px;")},Object(a["o"])(t+1),7)})),128)),x,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(t){return Object(a["h"])(),Object(a["d"])("span",{key:t,class:["small",e.possibleColors&1<<t?"possible":"notPossible"],style:"left: ".concat(5*t+1,"px;")},Object(a["o"])(n.getColor(t)),7)})),128))],14,["onClick"])})),128))]),r.debugMode||r.isSelfPlayer?(Object(a["h"])(),Object(a["d"])("div",I,[Object(a["g"])("button",{onClick:t[2]||(t[2]=function(e){return n.playCard(r.selectedCard)})},"Play"),Object(a["g"])("button",{onClick:t[3]||(t[3]=function(e){return n.discardCard(r.selectedCard)})},"Discard")])):Object(a["e"])("",!0),r.debugMode||!r.isSelfPlayer?(Object(a["h"])(),Object(a["d"])("div",T,[H,(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(e){return Object(a["h"])(),Object(a["d"])(a["a"],{key:e},[Object(a["g"])("button",{onClick:function(t){return n.hintNumber(e)}},Object(a["o"])(e+1),9,["onClick"]),A],64)})),128)),(Object(a["h"])(!0),Object(a["d"])(a["a"],null,Object(a["m"])(Array(5).fill().map((function(e,t){return t})),(function(e){return Object(a["h"])(),Object(a["d"])(a["a"],{key:e},[Object(a["g"])("button",{onClick:function(t){return n.hintColor(e)}},Object(a["o"])(n.getColor(e)),9,["onClick"]),M],64)})),128))])):Object(a["e"])("",!0)],2)})),U=(r("a9e3"),r("d4ec")),D=r("bee2"),z=(r("1276"),r("ac1f"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(U["a"])(this,e),this.number=1,this.color=1,this.possibleNumbers=31,this.possibleColors=31,this.number=t,this.color=r}return Object(D["a"])(e,[{key:"toString",value:function(){return"".concat(this.getColor()).concat(this.number+1)}},{key:"serialize",value:function(){return this.toString()+":".concat(this.possibleNumbers,":").concat(this.possibleColors)}},{key:"deserialize",value:function(e){this.color=L(e[0]),this.number=e[1].charCodeAt(0)-"1".charCodeAt(0);var t=e.substr(3).split(":");0<t.length&&(this.possibleNumbers=parseInt(t[0])),1<t.length&&(this.possibleColors=parseInt(t[1]))}},{key:"getColor",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(t=null!==(e=t)&&void 0!==e?e:this.color,t){case 0:return"r";case 1:return"g";case 2:return"b";case 3:return"y";case 4:return"w";case 5:return"x";default:return"?"}}},{key:"getClass",value:function(){switch(this.color){case 0:return"red";case 1:return"green";case 2:return"blue";case 3:return"yellow";case 4:return"white";case 5:return"rainbow";default:return""}}},{key:"hintNumber",value:function(e){return this.number===e?(this.possibleNumbers&=1<<e,!0):(this.possibleNumbers&=31&~(1<<e),!1)}},{key:"hintColor",value:function(e){return this.color===e?(this.possibleColors&=1<<e,!0):(this.possibleColors&=31&~(1<<e),!1)}}]),e}());function B(){for(var e=[],t=0;t<5;t++)for(var r=0;r<(0==t?3:t<4?2:1);r++)for(var n=0;n<5;n++)e.push(new z(t,n));return e}function _(e,t){return void 0===t&&(t=e.length-1),e.splice(t,1)[0]}function W(e){return String.fromCharCode("A".charCodeAt(0)+e)}function Y(e){return 0===e.length?"none are":1===e.length?W(e[0])+" is":e.reduce((function(t,r,n){return(n===e.length-1?t+" and ":0<n?t+", ":"")+W(r)}),"")+" are"}function L(e){switch(e){case"r":return 0;case"g":return 1;case"b":return 2;case"y":return 3;case"w":return 4;case"x":return 5;default:return-1}}var V={name:"Player ",props:{idx:Number,isSelfPlayer:Boolean,debugMode:Boolean,player:Object,selectedCard:Number,activeTurn:Boolean},setup:function(e,t){return{playerAutoClick:function(){return t.emit("playerAutoClick")},playerCardClick:function(e){return t.emit("playerCardClick",e)},playCard:function(e){return t.emit("playCard",e)},discardCard:function(e){return t.emit("discardCard",e)},getColor:function(e){return z.prototype.getColor(e)},hintNumber:function(e){return t.emit("hintNumber",e)},hintColor:function(e){return t.emit("hintColor",e)},cardLetter:W}}};r("69c6");V.render=R,V.__scopeId="data-v-5459dda5";var G=V,J=r("2909"),q=(r("c740"),r("53ca")),E=r("b85c");r("7db0"),r("4de4");function F(e,t){return e.reduce((function(e,r){return e+(t(r)?1:0)}),0)}var Z=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;Object(U["a"])(this,e),this.name="",this.auto=!1,this.name=t,this.auto=n,this.cards=a?Object(J["a"])(Array(4)).map((function(){return a(r,Math.floor(Math.random()*r.length))})):[]}return Object(D["a"])(e,[{key:"serialize",value:function(){var e={name:this.name,auto:this.auto,cards:this.cards.map((function(e){return e.serialize()}))};return this.playerId&&(e.playerId=this.playerId),this.lastHintedNumber&&(e.lastHintedNumber=this.lastHintedNumber),this.lastHintedColor&&(e.lastHintedColor=this.lastHintedColor),e}},{key:"deserialize",value:function(e){this.name=e.name,this.playerId=e.playerId,this.auto=e.auto,this.cards=e.cards.map((function(e){var t=new z;return t.deserialize(e),t})),this.lastHintedNumber=e.lastHintedNumber,this.lastHintedColor=e.lastHintedColor}},{key:"think",value:function(e,t,r,n,a){var s=this,i=function(){var t=s.lastHintedNumber;if(t){var r=t.number;if(e.globalTurn-e.players.length<=t.turn&&e.playedCards.find((function(e){return(0===r||e[r-1])&&!e[r]})))return s.cards.findIndex((function(e){return e.possibleNumbers===1<<r}))}var n=s.lastHintedColor;if(n){var a=F(s.cards,(function(e){return e.color===n.color}));if(1===a&&e.globalTurn-e.players.length<=n.turn)return s.cards.findIndex((function(e){return e.color===n.color}))}return-1}();if(0<=i)r(this,i,!0);else{if(0!==e.tokens){var o,l=Object(J["a"])(Array(5)).map((function(e,t){return t})).filter((function(t){return!!e.playedCards.find((function(e){return(0===t||e[t-1])&&!e[t]}))})),u=Object(E["a"])(e.players);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(c!==this){var d,b=Object(E["a"])(l);try{var h=function(){var t,r=d.value,n=0,s=0,i=Object(E["a"])(c.cards);try{var o=function(){var a=t.value;a.number===r&&s++,a.number===r&&a.possibleNumbers!==1<<r&&e.playedCards.find((function(e,t){return(0===r||e[r-1])&&!e[r]&&t===a.color}))&&n++};for(i.s();!(t=i.n()).done;)o()}catch(l){i.e(l)}finally{i.f()}if(0<s&&n===s)return a(c,r,!0),{v:void 0}};for(b.s();!(d=b.n()).done;){var f=h();if("object"===Object(q["a"])(f))return f.v}}catch(p){b.e(p)}finally{b.f()}}}}catch(p){u.e(p)}finally{u.f()}}n(this,this.cards.length-1,!0)}}},{key:"hintNumber",value:function(e,t){for(var r=[],n=0;n<this.cards.length;n++)this.cards[n].hintNumber(e)&&r.push(n);return this.lastHintedNumber={number:e,turn:t},r}},{key:"hintColor",value:function(e,t){for(var r=[],n=0;n<this.cards.length;n++)this.cards[n].hintColor(e)&&r.push(n);return this.lastHintedColor={color:e,turn:t},r}}]),e}(),K=(r("2b3d"),r("3ca3"),r("ddb0"),r("841c"),20);function Q(){if(ie||!le)return"";var e=le.collection("/sessions").doc();return e.set({}),localStorage.setItem("WebHanabiSessionId",e.id),e.id}function X(){if(ie||!le)return"";var e=new URLSearchParams(document.location.search.substring(1)),t=e.get("sessionId");if(t&&t.length===K)return t;var r=localStorage.getItem("WebHanabiSessionId");return t=r&&"string"===typeof r&&r.length===K?r:Q(),t}function $(e){localStorage.setItem("WebHanabiSessionId",e)}var ee=function(){function e(){Object(U["a"])(this,e),this.history=[],this.fieldCards=[],this.discardedCards=[],this.playedCards=Object(J["a"])(Array(5)).map((function(){return[]})),this.players=[],this.thePlayer=0,this.globalTurn=0,this.tokens=8,this.strikes=0,this.startDate=0,this.lastRoundBegun=-1,this.userName="",this.sessionId=X(),this.resetGame()}return Object(D["a"])(e,[{key:"gameOver",get:function(){return 3<=this.strikes||this.playedCards.reduce((function(e,t){return e&&0<t.length&&4===t[t.length-1].number}),!0)||0<=this.lastRoundBegun&&this.lastRoundBegun+this.players.length<=this.globalTurn}},{key:"resetGame",value:function(){var e=this;this.thePlayer=0,this.history=[],this.fieldCards=B(),this.discardedCards=[],this.playedCards=Object(J["a"])(Array(5)).map((function(){return[]})),this.players=Object(J["a"])(Array(4)).map((function(t,r){return new Z(r===e.thePlayer?e.userName:"Player ".concat(r),e.fieldCards,0!==r,_)})),this.players[this.thePlayer].playerId=de,this.globalTurn=0,this.tokens=8,this.strikes=0,this.startDate=Date.now(),this.endDate=void 0,this.lastRoundBegun=-1}},{key:"init",value:function(){var e=this;be().then((function(t){e.userName=t,e.players[e.thePlayer].name=t,e.players[e.thePlayer].playerId=de})),this.loadSession(this.sessionId).then((function(t){return e.deserializeSession(t)})),this.subscribe()}},{key:"setUserName",value:function(){!ie&&le?(le.collection("/users").doc(de).set({name:this.userName}),this.sessionId&&0<=this.thePlayer&&(this.players[this.thePlayer].name=this.userName,this.updateSession())):this.players[this.thePlayer].name=this.userName}},{key:"subscribe",value:function(){var e=this;!ie&&le&&(this.unsubscriber&&this.unsubscriber(),this.unsubscriber=le.collection("/sessions").doc(this.sessionId).onSnapshot({next:function(t){t.exists&&(e.deserializeSession(t),e.tryNextMove&&e.tryNextMove(!0))}}))}},{key:"newSession",value:function(){confirm("This session will be discarded. Are you sure?")&&(this.sessionId=Q(),this.subscribe(),this.resetGame(),this.updateSession())}},{key:"updateSession",value:function(){if(!ie&&le){console.log("updateSession ".concat(this.globalTurn));var e={history:this.history,fieldCards:this.fieldCards.map((function(e){return e.serialize()})),discardedCards:this.discardedCards.map((function(e){return e.serialize()})),playedCards:this.playedCards.map((function(e){return e.length})),players:this.players.map((function(e){return e.serialize()})),globalTurn:this.globalTurn,tokens:this.tokens,strikes:this.strikes,startDate:this.startDate};0<=this.lastRoundBegun&&(e.lastRoundBegun=this.lastRoundBegun),this.endDate&&(e.endDate=this.endDate),le.collection("/sessions").doc(this.sessionId).update(e)}}},{key:"deserializeSession",value:function(e){var t=this;if(!e)return null;var r=e.get("history");if(void 0===r)return null;var n=e.get("fieldCards");if(!n)return null;var a=e.get("discardedCards");if(!a)return null;var s=e.get("playedCards");if(!s)return null;var i=e.get("players");if(!i)return null;var o=e.get("globalTurn");if(void 0===o)return null;var l=e.get("tokens");if(void 0===l)return null;var u=e.get("strikes");if(void 0===u)return null;var c=e.get("startDate");if(void 0===c)return null;var d=e.get("endDate"),b=e.get("lastRoundBegun");console.log("deserializeSession ".concat(o)),this.history=r,this.fieldCards=n.map((function(e){var t=new z;return t.deserialize(e),t})),this.discardedCards=a.map((function(e){var t=new z;return t.deserialize(e),t})),this.playedCards=s.map((function(e,t){return Object(J["a"])(Array(e)).map((function(e,r){return new z(r,t)}))})),this.thePlayer=-1;var h=!1;if(this.players=i.map((function(e,r){var n=new Z("",[],void 0);return n.deserialize(e),n.playerId===de&&(t.thePlayer=r,h=!0),n})),this.globalTurn=o,this.tokens=l,this.strikes=u,this.lastRoundBegun=void 0===b?-1:b,this.startDate=c,this.endDate=d,!h){var f=this.players.findIndex((function(e){return!e.playerId}));0<=f&&(this.players[f].name=this.userName,this.players[f].playerId=de,this.players[f].auto=!1,this.updateSession())}}},{key:"loadSession",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!ie&&le){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,le.collection("/sessions").doc(t).get();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"joinSession",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=prompt("Enter session id"),t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.loadSession(t);case 5:r=e.sent,this.deserializeSession(r),this.sessionId=t,this.subscribe(),$(t);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"playerName",value:function(e){var t=this.players.indexOf(e);return t===this.thePlayer?"You":"Player ".concat(t)}}]),e}(),te={name:"WebHanabi",components:{PlayerCompo:G},setup:function(){var e=Object(a["k"])(new ee);e.init();var t=Object(a["l"])(-1),r=Object(a["b"])((function(){return e.globalTurn%e.players.length})),n=Object(a["l"])(!1),s=Object(a["b"])((function(){return"".concat(document.location.origin).concat(document.location.pathname,"?sessionId=").concat(e.sessionId)})),i=Object(a["l"])(null),o=!1;function l(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t||e.updateSession();var n=e.players[r.value];!n.auto||e.gameOver||o||0!==e.thePlayer||(o=!0,setTimeout((function(){var t=e.players[r.value];t.think(e,e.globalTurn,d,b,h),o=!1,l()}),1e3))}function u(n,a){r.value===e.players.indexOf(n)?t.value=a:console.log("Hey, it's not your turn! turn: ".concat(r.value,", player: ").concat(e.players.indexOf(n)))}function c(){e.gameOver&&(e.history.push("[".concat(e.globalTurn+1,"] The game is over! Your score was ").concat(e.playedCards.reduce((function(e,t){return e+t.length}),0))),e.endDate=Date.now())}function d(n,a){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(r.value===e.players.indexOf(n)&&(s||!n.auto&&r.value===e.thePlayer))if(a<0)alert("Please select a card.");else{var i=n.cards[a];n.cards.splice(a,1);var o=!1;0===e.playedCards[i.color].length&&0!==i.number||0<e.playedCards[i.color].length&&i.number!==e.playedCards[i.color][e.playedCards[i.color].length-1].number+1?(e.strikes++,o=!0):(e.playedCards[i.color].push(i),4===i.number&&(e.tokens=Math.min(8,e.tokens+1))),o&&e.discardedCards.push(i);var u=_(e.fieldCards,Math.floor(Math.random()*e.fieldCards.length));u&&n.cards.push(u),0===e.fieldCards.length&&e.lastRoundBegun<0&&(e.lastRoundBegun=e.globalTurn),e.history.push("[".concat(e.globalTurn+1,"] {P").concat(e.players.indexOf(n),"} played ").concat(W(a)," which is ").concat(i.toString()," and it was ").concat(o?"a strike":"ok")),e.globalTurn++,t.value=-1,c(),l()}else alert("Hey, it's not your turn!")}function b(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(r.value!==e.players.indexOf(t)||!a&&t.auto)alert("Hey, it's not your turn!");else if(n<0)alert("Please select a card.");else{var s=t.cards[n];t.cards.splice(n,1),e.discardedCards.push(s);var i=_(e.fieldCards,Math.floor(Math.random()*e.fieldCards.length));i&&t.cards.push(i),0===e.fieldCards.length&&e.lastRoundBegun<0&&(e.lastRoundBegun=e.globalTurn),e.history.push("[".concat(e.globalTurn+1,"] {P").concat(e.players.indexOf(t),"} discarded ").concat(W(n)," which is ").concat(s.toString())),e.globalTurn++,e.tokens=Math.min(8,e.tokens+1),c(),l()}}function h(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(a||!e.players[r.value].auto)if(!a&&e.players.indexOf(t)===e.thePlayer||e.players.indexOf(t)===r.value)alert("You can't hint yourself!");else if(e.tokens<=0)alert("You used up all tokens!");else{var s=t.hintNumber(n,e.globalTurn);e.history.push("[".concat(e.globalTurn+1,"] {P").concat(r.value,"} hinted {P").concat(e.players.indexOf(t),"} about ").concat(Y(s)," number ").concat(n+1)),e.globalTurn++,e.tokens--,c(),l()}else alert("Hey, it's not your turn!")}function f(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.gameOver)alert("The game is over.");else if(a||!e.players[r.value].auto)if(!a&&e.players.indexOf(t)===e.thePlayer||e.players.indexOf(t)===r.value)alert("You can't hint yourself!");else if(e.tokens<=0)alert("You used up all tokens!");else{var s=t.hintColor(n,e.globalTurn);e.history.push("[".concat(e.globalTurn+1,"] {P").concat(r.value,"} hinted {P").concat(e.players.indexOf(t),"} about ").concat(Y(s)," color ").concat(z.prototype.getColor(n))),e.globalTurn++,e.tokens--,c(),l()}else alert("Hey, it's not your turn!")}function p(t){return e.players.reduce((function(t,r,n){return t.replaceAll("{P".concat(n,"}"),n===e.thePlayer?"You":r.name)}),t)}function y(){var e=i.value;e&&(e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),alert("Copied the text: "+e.value))}return e.tryNextMove=l,{gameState:e,selectedCard:t,turn:r,playerCardClick:u,playCard:d,discardCard:b,hintNumber:h,hintColor:f,debugMode:n,userId:de,setUserName:function(){return e.setUserName()},togglePlayerAuto:function(e){e.auto=!e.auto,l()},newSession:function(){return e.newSession()},joinSession:function(){return e.joinSession()},historyReversed:Object(a["b"])((function(){var t=e.history.slice();return t.reverse(),t})),substituteHistory:p,sessionUrl:s,sessionUrlInput:i,copySessionUrl:y}}};r("40d1");te.render=j,te.__scopeId="data-v-2012f31c";var re=te,ne={name:"App",components:{WebHanabi:re}};r("adb1");ne.render=f;var ae=ne,se=r("2591"),ie=!1,oe={apiKey:"AIzaSyBAvtnHAo2_RAJpRWZNDDNOJOUN7gZppVo",authDomain:"web-hanabi.firebaseapp.com",projectId:"web-hanabi",storageBucket:"web-hanabi.appspot.com",messagingSenderId:"486326971095",appId:"1:486326971095:web:cba7224b5b6ce39cb39e92",measurementId:"G-93MV15EL3B"};se["a"].initializeApp(oe),se["a"].analytics();var le=ie?null:se["a"].firestore();function ue(){if(ie||!le)return"";var e=le.collection("/users").doc();e.set({name:"new user"});var t=e.id;return localStorage.setItem("WebHanabiUserId",t),t}function ce(){if(!ie&&le){var e=localStorage.getItem("WebHanabiUserId"),t="";return t=e&&"string"===typeof e&&0!==e.length?e:ue(),t}}var de=ce();function be(){return he.apply(this,arguments)}function he(){return he=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!ie&&le){e.next=2;break}return e.abrupt("return","new user");case 2:return e.next=4,le.collection("/users").doc(de).get();case 4:if(t=e.sent,!t.exists){e.next=7;break}return e.abrupt("return",t.get("name"));case 7:return e.abrupt("return","new user");case 8:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}Object(a["c"])(ae).mount("#app")},fef3:function(e,t,r){}});
//# sourceMappingURL=app.f5169da1.js.map